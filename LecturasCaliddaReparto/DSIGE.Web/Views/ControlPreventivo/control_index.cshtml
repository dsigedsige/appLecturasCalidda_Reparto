@{
    ViewBag.Title = "Control Preventivo";
    Layout = "~/Views/Shared/_LayoutPrincipal.cshtml";
}

@section instances{
    @Styles.Render("~/Content/bootstrap-table/bootstrap-table.css")
    @Scripts.Render("~/Content/bootstrap-table/bootstrap-table.js")
    @Scripts.Render("~/Content/bootstrap-table/locale/bootstrap-table-es-MX.js")

    @Scripts.Render("~/Content/bootstrap/js/bootstrap-toggle.min.js")
    @Scripts.Render("~/Content/angular/angular.js")
    <script src="~/Content/pdf/html2canvas.js"></script>

    @Scripts.Render("~/Content/pdf/jspdf.js")
    @Scripts.Render("~/Content/pdf/pdfFromHTML.js")
    @Scripts.Render("~/Content/pdf/jspdf.plugin.autotable.js")
    @Styles.Render("~/Content/bootstrap/css/bootstrap-toggle.min.css")

    @Styles.Render("~/Content/bootstrap-datepicker/css/bootstrap-datepicker.min.css")
    @Scripts.Render("~/Content/bootstrap-datepicker/js/bootstrap-datepicker.min.js")
    @Scripts.Render("~/Content/bootstrap-datepicker/locales/bootstrap-datepicker.es.min.js")

    @Styles.Render("~/Content/dataTables-bootstrap/css/dataTables.bootstrap.min.css")
    @Scripts.Render("~/Content/dataTables-bootstrap/js/jquery.dataTables.min.js")
    @Scripts.Render("~/Content/dataTables-bootstrap/js/dataTables.bootstrap.min.js")
}

<style>
    .form-control {
        font-size: 11px;
        width: 100%;
        height: 28px;
    }

    input[type="text"] {
        font-size: 11px;
    }

    .btn {
        font-size: 12px;
    }

    input[type="text"] {
        font-size: 11px;
    }

    label {
        font-family: "Tahoma", "Geneva", sans-serif;
        font-size: 11px;
        font-weight: bold;
    }

    .datepicker {
        width: 200px;
    }

    table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

    td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #dddddd;
    }
</style>

<script type="text/javascript">
    var app = angular.module('appControlPreventivo', []);

    app.directive('onFinishRender', function ($timeout) {
        return {
            restrict: 'A',
            link: function (scope, element, attr) {
                if (scope.$last === true) {
                    $timeout(function () {
                        scope.$emit(attr.onFinishRender);
                    });
                }
            }
        }
    });

    app.controller('ctrlControl', function ($scope, $http, $timeout, $q) {
        $(function () {
            $('#id_fecha').datepicker({
                format: 'dd/mm/yyyy',
                language: 'es',
                autoclose: true
            });
        });

        //$scope.Obj_List_Servicios = [];
        //$scope.Listado_Servicios = function () {
        //    var variables = {
        //        method: 'POST',
        //        url: '../GeneracionActas/ServiciosAll',
        //        headers: {
        //            'Content-Type': 'application/json; charset=utf-8'
        //        }
        //    }
        //    $http(variables)
        //    .success(function (data) {
        //        $scope.Obj_List_Servicios = [];
        //        $scope.Obj_List_Servicios = data;
        //    })
        //    .error(function () {
        //        alert('Ocurrio un problema con la conexion, vuelva a intentar.')
        //    });
        //}


        $scope.Obj_List_Servicios = [];
        $scope.Listado_Servicios = function () {
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/getAreas',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                }
            }
            $http(variables)
            .success(function (data) {
                $scope.Obj_List_Servicios = [];
                $scope.Obj_List_Servicios = data;
            })
            .error(function () {
                alert('Ocurrio un problema con la conexion, vuelva a intentar.')
            });
        }



        $scope.Obj_List_Operario = [];
        $scope.Listado_Operarios = function () {
            var variables = {
                method: 'POST',
                url: '../VerificacionFotos/ListandoOperarios',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                }
            }
            $http(variables)
            .success(function (data) {
                $scope.Obj_List_Operario = [];
                $scope.Obj_List_Operario = data;
            })
            .error(function () {
                alert('Ocurrio un problema con la conexion, vuelva a intentar.')
            });
        }
        ;

        var oTable_cabecera = null;
        $scope.$on('ngRepeatFinished_cabecera', function (ngRepeatFinishedEvent) {
            oTable_cabecera = $('#tblLista').DataTable(
                 {
                     scrollY: "400px",
                     paging: false,
                 });
        });


        $scope.inicializando_variables = function () {
            $scope.id_area = '0';
            $scope.id_operario = '0';
            $scope.tipo_reporte = '1';            
            $scope.Listado_Servicios();
            $scope.Listado_Operarios()
        }


        $scope.Obj_List_Cabecera = [];
        $scope.Listado_Cabecera_Inspecciones = function () {

            var cbo_area = document.getElementById('cbo_area').value;
            var cbo_operario = document.getElementById('cbo_operario').value;
            var id_fecha = document.getElementById('id_fecha').value;
            var cbo_tipoReporte = document.getElementById('cbo_tipoReporte').value;

            if (cbo_area == '' || cbo_area == 0) {
                new PNotify({
                    title: 'Sistemas',
                    text: 'Por favor seleccione una Actividad.',
                    type: 'error'
                });
                return;
            }
            if (id_fecha == '') {
                new PNotify({
                    title: 'Sistemas',
                    text: 'Por favor ingrese o seleccione una Fecha Inicial.',
                    type: 'error'
                });
                return;
            }
            if (cbo_tipoReporte == '' || cbo_tipoReporte == 0 || cbo_tipoReporte == ''  ) {
                new PNotify({
                    title: 'Sistemas',
                    text: 'Por favor seleccione un Tipo de Reporte.',
                    type: 'error'
                });
                return;
            }


            $('.sige-load').show();

            var variables = {
                method: 'POST',
                url: '../GeneracionActas/Mostrando_informacion_Inspecciones',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    servicio: cbo_area,
                    operario: cbo_operario,
                    fecha: id_fecha,
                    tipoReporte: cbo_tipoReporte
                }
            }
            $http(variables)
            .success(function (data) {
                $('.sige-load').hide();
                $scope.Obj_List_Cabecera = [];
                $timeout(function () {
                    if (oTable_cabecera == null) {
                        $scope.Obj_List_Cabecera = data;
                    } else {
                        oTable_cabecera.clear();
                        oTable_cabecera.destroy();
                        oTable_cabecera = null;
                        $scope.Obj_List_Cabecera = data;
                    }
                }, 100);
            })
            .error(function () {
                $('.sige-load').hide();
                alert('Ocurrio un problema con la conexion, vuelva a intentar.')

            });
        }






        $scope.progress = 0;
        function descargarFoto(item) {
            var q = $q.defer();
            $timeout(function () {
                $scope.crear_pdf_inspecciones(item).then(function () {
                    $scope.progress += (100 / (parseFloat($scope.Obj_List_Cabecera.length)));
                    q.resolve('k');
                });
            }, 1000)
            return q.promise;
        }

        $scope.descargarMasivo = function () {
            var q = $q.defer();
            $scope.progress = 0;
            $scope.Obj_List_Cabecera.reduce(function (p, val) {
                return p.then(function () {
                    return descargarFoto(val);
                });
            }, $q.when(true)).then(function (finalResult) {
                q.resolve('success');
            }, function (err) {
                q.reject(err);
            });

            return q.promise;

        }

        var getCodUniq = function () {
            // CAPTURANDO FECHA ACTUAL
            var hoy = new Date();
            var dd = hoy.getDate();
            var mm = hoy.getMonth() + 1;
            var yyyy = hoy.getFullYear();
            var hour = hoy.getHours();
            var minuts = hoy.getMinutes();
            var second = hoy.getSeconds();
            if (dd < 10) {
                dd = '0' + dd
            }

            if (mm < 10) {
                mm = '0' + mm
            }
            hoy = yyyy + '' + mm + '' + dd + '' + hour + '' + minuts + '' + second;
            // GENERANDO CODIGO ALEATORIO
            var codigoAle = Math.floor(Math.random() * 1000000);

            return codigoAle + '_' + hoy;
        }
  

        $scope.crear_pdf_inspecciones_anterior = function (obj_data) {
            var q = $q.defer();
            if ($scope.tipo_reporte == '1' && $scope.tipo_reporte == 1) {
                $scope.getPdf_3(obj_data, 1).then(function () {
                    q.resolve('ok');
                }, function (err) {
                    q.reject(err);
                }); 
            } else {
                $scope.getPdf_4(obj_data,2).then(function () {
                    q.resolve('ok');
                }, function (err) {
                    q.reject(err);
                }); 
            }
            return q.promise;
        }



        $scope.crear_pdf_inspecciones = function (obj_data) {
            var q = $q.defer();
            if ($scope.tipo_reporte == '1' && $scope.tipo_reporte == 1) {
                $scope.getPdf_calidda(obj_data, 1).then(function () {
                    q.resolve('ok');
                }, function (err) {
                    q.reject(err);
                });
            }
            else if ($scope.tipo_reporte == '2' && $scope.tipo_reporte == 2) {
                $scope.getPdf_motorizado(obj_data, 2).then(function () {
                    q.resolve('ok');
                }, function (err) {
                    q.reject(err);
                });
            }
            else if ($scope.tipo_reporte == '3' && $scope.tipo_reporte == 3) {
                $scope.getPdf_charla(obj_data, 3).then(function () {
                    q.resolve('ok');
                }, function (err) {
                    q.reject(err);
                });
            }
            return q.promise;
        }
                
        $scope.getPdf_3_anteriorPagina = function (data) {
            var q = $q.defer();

            $('.sige-load').show(); 
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/get_generacionPdf_inspecciones',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    id_inspeccion: data.id_Inspeccion,
                }
            }
            $http(variables)
                .success(function (obj_data) {
                    $('.sige-load').hide();
                    if (obj_data.length > 0) {

                        var doc = new jsPDF();
                        var altura = 12;
                        var imgLogo = '';
                        //doc.addImage(imgLogo, 'JPEG', 10, 4, 60, 25)

                        doc.setFontSize(13);
                        doc.setFont("courier");
                        doc.setFontType("bold");
                        doc.text(80, altura, 'CONTROL PREVENTIVO');
                        doc.setFontType("normal");
                        doc.setFontSize(6);
                        doc.text(165, altura, 'Código: CO-FO-9122-SSOMA-021');
                        altura = altura + 3;
                        doc.setFontType("normal");
                        doc.setFontSize(7);
                        doc.text(90, altura, 'Lista de autochequeo'); doc.setFontSize(6); doc.text(165, altura, 'Rev.: 00');
                        altura = altura + 3;
                        doc.setFontSize(7);
                        doc.text(90, altura, 'Servicios Auxiliares'); doc.setFontSize(6); doc.text(165, altura, 'Fecha: Mayo 2019');
                        altura = altura + 4;
                        doc.setFontSize(7);
                        doc.setFontType("bold");
                        doc.text(6, altura, 'OPERARIO :'); doc.text(90, altura, 'AREA :');
                        altura = altura + 4;
                        doc.text(6, altura, 'EMPRESA :'); doc.text(90, altura, 'FECHA :'); doc.text(150, altura, 'HORA :');
                        altura = altura + 4;
                        doc.setFontSize(9);
                        doc.text(60, altura, 'Campo a verificar al inicio de la jornada (en la base)');
                        altura = altura + 6;
                        doc.setFontSize(6);

                        //-----lado izquierdo---------------------
                        doc.setDrawColor(0)
                        doc.setFillColor(220, 220, 220)

                        doc.rect(5, altura - 3, 59, 8, 'FD');
                        doc.setDrawColor(0)
                        doc.setFillColor(220, 220, 220)
                        doc.rect(64, altura - 3, 30, 4, 'FD');
                        doc.text(65, altura, 'Disponible     ESTADO');
                        //-----lado Derecho---------------------
                        doc.setDrawColor(0)
                        doc.setFillColor(220, 220, 220)
                        doc.rect(98, altura - 3, 75, 8, 'FD');

                        doc.setDrawColor(0)
                        doc.setFillColor(220, 220, 220)
                        doc.rect(173, altura - 3, 30, 4, 'FD');
                        doc.text(174, altura, 'Disponible     ESTADO');

                        doc.setFontSize(8);
                        doc.text(12, altura, 'PROTECCIONES INDIVIDUALES Y');
                        altura = altura + 2;
                        doc.text(120, altura, 'MEDIOS DE TRABAJO');
                        altura = altura + 2;
                        doc.text(25, altura, 'ESPECIFICAS');
                        //-----lado izquierdo---------------------
                        doc.text(65, altura, 'SI'); doc.rect(64, altura - 3, 5, 4);
                        doc.text(70, altura, 'NO'); doc.rect(69, altura - 3, 5, 4);
                        doc.text(75, altura, 'NA'); doc.rect(74, altura - 3, 5, 4);
                        doc.text(80, altura, 'B'); doc.rect(79, altura - 3, 5, 4);
                        doc.text(85, altura, 'M'); doc.rect(84, altura - 3, 5, 4);
                        doc.text(90, altura, 'NA'); doc.rect(89, altura - 3, 5, 4);
                        //-----lado Derecho---------------------
                        doc.text(174, altura, 'SI'); doc.rect(173, altura - 3, 5, 4);
                        doc.text(179, altura, 'NO'); doc.rect(178, altura - 3, 5, 4);
                        doc.text(184, altura, 'NA'); doc.rect(183, altura - 3, 5, 4);
                        doc.text(189, altura, 'B'); doc.rect(188, altura - 3, 5, 4);
                        doc.text(194, altura, 'M'); doc.rect(193, altura - 3, 5, 4);
                        doc.text(199, altura, 'NA'); doc.rect(198, altura - 3, 5, 4);
                        doc.setFontSize(7);
                        doc.setFontType("normal");

                        for (item of obj_data) {
                            if (item.Lado == 1) {
                                if (item.id_CheckList > 1) {
                                    altura = altura + 4;
                                    doc.text(6, altura, item.descripcion); doc.rect(5, altura - 3, 59, 4);
                                    doc.text(65, altura, item.valor_SI); doc.rect(64, altura - 3, 5, 4);
                                    doc.text(70, altura, item.valor_NO); doc.rect(69, altura - 3, 5, 4);
                                    doc.text(75, altura, item.valor_NA); doc.rect(74, altura - 3, 5, 4);
                                    doc.text(80, altura, item.valor_B); doc.rect(79, altura - 3, 5, 4);
                                    doc.text(85, altura, item.valor_M); doc.rect(84, altura - 3, 5, 4);
                                    doc.text(90, altura, item.valor_NA2); doc.rect(89, altura - 3, 5, 4);
                                }
                            }
                        }
                        altura = 40;
                        for (row of obj_data) {
                            if (row.Lado == 2) {
                                if (row.id_CheckList > 31) {
                                    altura = altura + 4;
                                    doc.text(100, altura, row.descripcion); doc.rect(98, altura - 3, 75, 4);
                                    doc.text(174, altura, row.valor_SI); doc.rect(173, altura - 3, 5, 4);
                                    doc.text(179, altura, row.valor_NO); doc.rect(178, altura - 3, 5, 4);
                                    doc.text(184, altura, row.valor_NA); doc.rect(183, altura - 3, 5, 4);
                                    doc.text(189, altura, row.valor_B); doc.rect(188, altura - 3, 5, 4);
                                    doc.text(194, altura, row.valor_M); doc.rect(193, altura - 3, 5, 4);
                                    doc.text(199, altura, row.valor_NA2); doc.rect(198, altura - 3, 5, 4);
                                }
                            }
                        }

                        var generarPDF = function () {

                            doc.setFontType("bold");
                            doc.setFontSize(10);
                            doc.text(60, altura, 'Verificar antes del inicio de la jornada.');
                            altura = altura + 6;
                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.setFontType("bold");
                            doc.text(6, altura, '1. Condiciones de Zona de Trabajo (Evaluación y verificación de la zona de trabajo, Interferencia con terceros, clima del ambiente, etc.)');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("bold");
                            doc.text(6, altura, '2. Comprobación de entorno de suministro');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("normal");
                            doc.text(6, altura, '- Identificación visual  (Medidor de Suministro con objetos suspendidos sobre éste, Medidor de suministros sin acceso o acceso ');
                            altura = altura + 4;
                            doc.text(6, altura, '  inseguro Medidor de Suministro Inteno; Medidor de suminsitro ubicado en Altura)');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '- En caso de medidores de suministros ubicados en azoteas o altura con accesos no estandarizados, reportar el suministro ');
                            altura = altura + 4;
                            doc.text(6, altura, '  con el responsable del área, para que éste asigne el trabajo a la cuadrilla correspondiente.');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("bold");
                            doc.text(6, altura, '3. Trabajo en Altura:');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("normal");
                            doc.text(6, altura, '-  Escaleras (revisión  de  estado de peldaños, zapatas, largueros, atado correcto de la escalera al poste…)');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '-  Sistema anticaída (arnés anticaídas, cuerda semiestatica, estrobo, grip, línea de vida….)');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '-  Trabajo a medio tramo/vano: carro porta-escaleras, coordinar con Supervisor de Obra.');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '-  Trabajo en armario (revisión del estado de la plataforma, barandas, soportes, abrazaderas y tuercas libres de corrosión,');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '   deterioro y/o ausencias de estas)');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("bold");
                            doc.text(6, altura, '4. Trabajos en Azotea ');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("normal");
                            doc.text(6, altura, '- Verificación de techo (material noble, Presencia de animales, Estructura)');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("bold");
                            doc.text(6, altura, '5. Trabajos en Fachada');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("normal");
                            doc.text(6, altura, '- Verificación de las fachadas.');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '- Verificación del tipo de anclaje.');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.text(6, altura, '- Verificación de la ausencia de instalaciones eléctricas "hechizas"');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 4;
                            doc.setFontType("bold");
                            doc.text(6, altura, '6. Trabajo con desplazamiento en vehículos menores  ');
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            doc.setFontType("normal");
                            altura = altura + 8;

                            doc.text(20, altura + 2, 'MEDIOS DE TRABAJO');
                            doc.rect(5, altura - 3, 65, 8);
                            doc.text(77, altura, 'Ejecucion'); doc.rect(70, altura - 3, 30, 4);
                            altura = altura + 4;
                            doc.text(80, altura, 'Si/No'); doc.rect(70, altura - 3, 30, 4);

                            for (items of obj_data) {
                                if (items.Lado == 3) {
                                    if (items.id_CheckList > 62) {
                                        altura = altura + 4;
                                        doc.text(6, altura, items.descripcion);
                                        doc.rect(5, altura - 3, 65, 4);
                                        doc.rect(70, altura - 3, 30, 4);
                                        doc.text(80, altura, items.valor_SI);
                                    }
                                }
                            }

                            var string = doc.output('datauristring');
                            var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";
                            var x = window.open();
                            x.document.open();
                            x.document.write(iframe);
                            x.document.close();
                            q.resolve('success');
                        }

                        var generarImagen_2 = function () {
                            //var imgData2 = String(obj_data.ruta_foto_2)
                            var imgData2 = String('../content/foto/foto/1000127_1_08012019_1452452900.jpg');
                            var img2 = new Image;
                            img2.onload = function () {
                                doc.addImage(this, 'JPEG', 150, 275, 28, 15);
                                generarPDF();
                            };
                            img2.crossOrigin = "";  // for demo as we are at different origin than image
                            img2.src = imgData2;  // some random imgur image
                            doc.setFontType("bold");
                            doc.text(150, 293, 'Firma de trabajador');
                            doc.setFontType("normal");
                        }

                        altura = 156;
                        doc.setFontSize(9);
                        doc.setFontType("bold");
                        doc.text(6, 175, 'Nombre y apellidos: LANGUASCO BARRON JULIO CESAR ');
                        doc.text(137, 175, 'Firma:');
                        doc.line(6, 176.5, 148, 176.5) // horizontal line

                        doc.setFontSize(7);
                        doc.setFontType("normal");

                        var imgData = String('../content/foto/foto/10109278_04092018_1441302710.jpg');
                        var img = new Image;
                        img.onload = function () {
                            doc.addImage(this, 'JPEG', 150, 168, 28, 15);
                            generarImagen_2();
                        };
                        img.crossOrigin = "";
                        img.src = imgData;  // some random imgur image
                        altura = altura + 29;

                    } else {
                        q.resolve('success');
                    }
                })
                .error(function () {
                    $('.sige-load').hide();
                });
            return q.promise;

        }

        $scope.getPdf_3 = function (data, tipo) {
            var q = $q.defer();

            $('.sige-load').show();
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/get_generacionPdf_inspecciones',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    id_inspeccion: data.id_Inspeccion,
                    tipoReporte: tipo
                }
            }
            $http(variables)
                .success(function (obj_data) {
                    $('.sige-load').hide();
                    if (obj_data.length > 0) {

                        var doc = new jsPDF();
                        var altura = 12;
                        var cuerpoReporte = function () {            
                            doc.setFontSize(13);
                            doc.setFont("courier");
                            doc.setFontType("bold");
                            doc.text(80, altura, 'CONTROL PREVENTIVO');
                            doc.setFontType("normal");
                            doc.setFontSize(6);
                            doc.text(165, altura, 'Código: ' + obj_data[0].codigo );
                            altura = altura + 3;
                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(90, altura, 'Lista de autochequeo'); doc.setFontSize(6); doc.text(165, altura, 'Rev.: ' + obj_data[0].rev);
                            altura = altura + 3;
                            doc.setFontSize(7);
                            doc.text(90, altura, 'Servicios Auxiliares'); doc.setFontSize(6); doc.text(165, altura, 'Fecha:' + obj_data[0].fecha);
                            altura = altura + 4;
                            doc.setFontSize(7);
                            doc.setFontType("bold");
                            doc.text(6, altura, 'OPERARIO : ' + obj_data[0].operario); doc.text(90, altura, 'AREA : ' + obj_data[0].area );
                            altura = altura + 4;
                            doc.text(6, altura, 'EMPRESA : ' + obj_data[0].empresa); doc.text(90, altura, 'FECHA : ' + obj_data[0].fechafiltro); doc.text(150, altura, 'HORA : ' + obj_data[0].hora);
                            altura = altura + 4;
                            doc.setFontSize(9);
                            doc.text(60, altura, 'Campo a verificar al inicio de la jornada (en la base)');
                            altura = altura + 6;
                            doc.setFontSize(6);

                            //-----lado izquierdo---------------------
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)

                            doc.rect(5, altura - 3, 59, 8, 'FD');
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(64, altura - 3, 30, 4, 'FD');
                            doc.text(65, altura, 'Disponible     ESTADO');
                            //-----lado Derecho---------------------
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(98, altura - 3, 75, 8, 'FD');

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(173, altura - 3, 30, 4, 'FD');
                            doc.text(174, altura, 'Disponible     ESTADO');

                            doc.setFontSize(8);
                            doc.text(12, altura, 'PROTECCIONES INDIVIDUALES Y');
                            altura = altura + 2;
                            doc.text(120, altura, 'MEDIOS DE TRABAJO');
                            altura = altura + 2;
                            doc.text(25, altura, 'ESPECIFICAS');
                            //-----lado izquierdo---------------------
                            doc.text(65, altura, 'SI'); doc.rect(64, altura - 3, 5, 4);
                            doc.text(70, altura, 'NO'); doc.rect(69, altura - 3, 5, 4);
                            doc.text(75, altura, 'NA'); doc.rect(74, altura - 3, 5, 4);
                            doc.text(80, altura, 'B'); doc.rect(79, altura - 3, 5, 4);
                            doc.text(85, altura, 'M'); doc.rect(84, altura - 3, 5, 4);
                            doc.text(90, altura, 'NA'); doc.rect(89, altura - 3, 5, 4);
                            //-----lado Derecho---------------------
                            doc.text(174, altura, 'SI'); doc.rect(173, altura - 3, 5, 4);
                            doc.text(179, altura, 'NO'); doc.rect(178, altura - 3, 5, 4);
                            doc.text(184, altura, 'NA'); doc.rect(183, altura - 3, 5, 4);
                            doc.text(189, altura, 'B'); doc.rect(188, altura - 3, 5, 4);
                            doc.text(194, altura, 'M'); doc.rect(193, altura - 3, 5, 4);
                            doc.text(199, altura, 'NA'); doc.rect(198, altura - 3, 5, 4);
                            doc.setFontSize(7);
                            doc.setFontType("normal");

                            for (item of obj_data) {
                                if (item.Lado == 1) {
                                    if (item.id_CheckList > 1) {
                                        altura = altura + 4;
                                        doc.text(6, altura, item.descripcion); doc.rect(5, altura - 3, 59, 4);
                                        doc.text(65, altura, item.valor_SI); doc.rect(64, altura - 3, 5, 4);
                                        doc.text(70, altura, item.valor_NO); doc.rect(69, altura - 3, 5, 4);
                                        doc.text(75, altura, item.valor_NA); doc.rect(74, altura - 3, 5, 4);
                                        doc.text(80, altura, item.valor_B); doc.rect(79, altura - 3, 5, 4);
                                        doc.text(85, altura, item.valor_M); doc.rect(84, altura - 3, 5, 4);
                                        doc.text(90, altura, item.valor_NA2); doc.rect(89, altura - 3, 5, 4);
                                    }
                                }
                            }
                            altura = 40
                            for (row of obj_data) {
                                if (row.Lado == 2) {
                                    if (row.id_CheckList > 31) {
                                        altura = altura + 4;
                                        doc.text(100, altura, row.descripcion); doc.rect(98, altura - 3, 75, 4);
                                        doc.text(174, altura, row.valor_SI); doc.rect(173, altura - 3, 5, 4);
                                        doc.text(179, altura, row.valor_NO); doc.rect(178, altura - 3, 5, 4);
                                        doc.text(184, altura, row.valor_NA); doc.rect(183, altura - 3, 5, 4);
                                        doc.text(189, altura, row.valor_B); doc.rect(188, altura - 3, 5, 4);
                                        doc.text(194, altura, row.valor_M); doc.rect(193, altura - 3, 5, 4);
                                        doc.text(199, altura, row.valor_NA2); doc.rect(198, altura - 3, 5, 4);
                                    }
                                }
                            }

                            var generarPDF = function () {
 
                                doc.setFontType("bold");
                                doc.setFontSize(10);
                                doc.text(60, altura, 'Verificar antes del inicio de la jornada.');
                                altura = altura + 6;
                                doc.setFontType("normal");
                                doc.setFontSize(7);
                                doc.setFontType("bold");
                                doc.text(6, altura, '1. Condiciones de Zona de Trabajo (Evaluación y verificación de la zona de trabajo, Interferencia con terceros, clima del ambiente, etc.)');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("bold");
                                doc.text(6, altura, '2. Comprobación de entorno de suministro');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("normal");
                                doc.text(6, altura, '- Identificación visual  (Medidor de Suministro con objetos suspendidos sobre éste, Medidor de suministros sin acceso o acceso ');
                                altura = altura + 4;
                                doc.text(6, altura, '  inseguro Medidor de Suministro Inteno; Medidor de suminsitro ubicado en Altura)');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '- En caso de medidores de suministros ubicados en azoteas o altura con accesos no estandarizados, reportar el suministro ');
                                altura = altura + 4;
                                doc.text(6, altura, '  con el responsable del área, para que éste asigne el trabajo a la cuadrilla correspondiente.');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("bold");
                                doc.text(6, altura, '3. Trabajo en Altura:');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("normal");
                                doc.text(6, altura, '-  Escaleras (revisión  de  estado de peldaños, zapatas, largueros, atado correcto de la escalera al poste…)');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '-  Sistema anticaída (arnés anticaídas, cuerda semiestatica, estrobo, grip, línea de vida….)');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '-  Trabajo a medio tramo/vano: carro porta-escaleras, coordinar con Supervisor de Obra.');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '-  Trabajo en armario (revisión del estado de la plataforma, barandas, soportes, abrazaderas y tuercas libres de corrosión,');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '   deterioro y/o ausencias de estas)');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("bold");
                                doc.text(6, altura, '4. Trabajos en Azotea ');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("normal");
                                doc.text(6, altura, '- Verificación de techo (material noble, Presencia de animales, Estructura)');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("bold");
                                doc.text(6, altura, '5. Trabajos en Fachada');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("normal");
                                doc.text(6, altura, '- Verificación de las fachadas.');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '- Verificación del tipo de anclaje.');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.text(6, altura, '- Verificación de la ausencia de instalaciones eléctricas "hechizas"');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                altura = altura + 4;
                                doc.setFontType("bold");
                                doc.text(6, altura, '6. Trabajo con desplazamiento en vehículos menores  ');
                                doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                                doc.setFontType("normal");
                                altura = altura + 8;

                                doc.text(20, altura + 2, 'MEDIOS DE TRABAJO');
                                doc.rect(5, altura - 3, 65, 8);
                                doc.text(77, altura, 'Ejecucion'); doc.rect(70, altura - 3, 30, 4);
                                altura = altura + 4;
                                doc.text(80, altura, 'Si/No'); doc.rect(70, altura - 3, 30, 4);

                                for (items of obj_data) {
                                    if (items.Lado == 3) {
                                        if (items.id_CheckList > 62) {
                                            altura = altura + 4;
                                            doc.text(6, altura, items.descripcion);
                                            doc.rect(5, altura - 3, 65, 4);
                                            doc.rect(70, altura - 3, 30, 4);
                                            doc.text(80, altura, items.valor_SI);
                                        }
                                    }
                                }

                                //var string = doc.output('datauristring');
                                //var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";
                                //var x = window.open();
                                //x.document.open();
                                //x.document.write(iframe);
                                //x.document.close();
                                doc.save('Formato1_controlPreventivo.pdf');
                                q.resolve('success');

                            }

                            var generarImagen_2 = function () {
                                var imgData2 = String(obj_data[0].ruta_foto_2)
                                //var imgData2 = String('../content/foto/foto/1000127_1_08012019_1452452900.jpg');
                                var img2 = new Image;
                                doc.addPage()
                                altura = 12;

                                img2.onload = function () {
                                    doc.addImage(this, 'JPEG', 150, 100, 32, 25);
                                    generarPDF();
                                };
                                img2.crossOrigin = "";  // for demo as we are at different origin than image
                                img2.src = imgData2;  // some random imgur image
                                doc.setFontType("bold");
                                doc.text(152, 97, 'Firma de trabajador');
                                doc.setFontType("normal");
                            }

                            //altura = 156;
                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.text(6, altura + 30, 'Nombre y apellidos:  ' + obj_data[0].nombreApellidos );
                            doc.text(137, altura + 30 , 'Firma:');
                            doc.line(6, altura + 31, 148, altura + 31) // horizontal line

                            doc.setFontSize(7);
                            doc.setFontType("normal");
 
                            var imgData = String(obj_data[0].ruta_foto_1)
                            //var imgData = String('../content/foto/foto/10109278_04092018_1441302710.jpg');
                            var img = new Image;
                            img.onload = function () {
                                doc.addImage(this, 'JPEG', 150, altura, 32, 25);
                                generarImagen_2();
                            };
                            img.crossOrigin = "";
                            img.src = imgData;  // some random imgur image
                            altura = altura + 20;

                        }

                        var imgDataLogo = String('../Content/Imagen/logoCobra.png');
                        var imgL = new Image;
                        imgL.onload = function () {
                            doc.addImage(this, 'JPEG', 6, 4, 40, 15);
                            cuerpoReporte();
                        };
                        imgL.crossOrigin = "";
                        imgL.src = imgDataLogo;  // some random imgur image

                    } else {
                        q.resolve('success');
                    }
                })
                .error(function () {
                    $('.sige-load').hide();
                });
            return q.promise;

        }

        $scope.getPdf_4 = function (data, tipo) {
            var q = $q.defer();

            $('.sige-load').show();
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/get_generacionPdf_inspecciones',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    id_inspeccion: data.id_Inspeccion,
                    tipoReporte: tipo
                }
            }

            $http(variables)
                .success(function (obj_data) {
                    $('.sige-load').hide();
                    if (obj_data.length > 0) {
                        var doc = new jsPDF();
                        var altura = 12;
                        var lados = 0;

                        // inicio del cuerpo del  reporte
                        var cuerpoReporte2 = function () {

                            doc.setFontSize(13);
                            doc.setFont("courier");
                            doc.setFontType("bold");
                            doc.text(80, altura, 'CONTROL PREVENTIVO');
                            doc.setFontType("normal");
                            doc.setFontSize(6);
                            doc.text(165, altura, 'Código: ' + obj_data[0].codigo);
                            altura = altura + 3;
                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(90, altura, 'CHARLA PREOPERACIONAL'); doc.setFontSize(6); doc.text(165, altura, 'Rev.: ' + obj_data[0].rev);
                            altura = altura + 3;
                            doc.setFontSize(7);
                            doc.text(90, altura, 'Servicios Auxiliares'); doc.setFontSize(6); doc.text(165, altura, 'Fecha: ' + obj_data[0].fecha);
                            altura = altura + 8;
                            doc.setFontSize(8);
                            doc.setFontType("bold");
                            doc.text(6, altura, 'NOMBRE EMPRESA: ' + obj_data[0].empresa);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.text(6, altura, 'RESPONSABLE DE TRABAJO: ' + obj_data[0].responsable);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.text(6, altura, 'TÍTULO DEL TRABAJO: ' + obj_data[0].titulo);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.text(6, altura, 'LUGAR: ' + obj_data[0].lugar); doc.text(90, altura, 'FECHA : ' + obj_data[0].fechafiltro); doc.text(150, altura, 'HORA : ' + obj_data[0].hora);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line

                            altura = altura + 10;
                            doc.text(35, altura, 'ANTES DE REALIZAR LOS TRABAJOS ASIGNADOS VERIFICAR Y REALIZAR LO SIGUIENTE: ');
                            doc.line(35, altura + 1.5, 160, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.setFontSize(7);
                            doc.text(6, altura, '¤ Charla Pre Operacional, reconociendo previamente su zona de trabajo. Identificar los peligros y evaluar los riesgos, ');
                            altura = altura + 3;
                            doc.text(6, altura, '  estableciendo las medidas de control vinculadas.');
                            altura = altura + 4;
                            doc.text(6, altura, '¤ Revisar que los EPP, herramientas y otros medios de trabajos se encuentren en buen estado de conservación.');

                            altura = altura + 4;
                            doc.setFontType("normal");
                            doc.text(6, altura, '* Luego de la evaluación del entorno de trabajo, marcar con una X los peligros y riesgos identificados. Anotar en el apartado');
                            altura = altura + 3;
                            doc.text(6, altura, '*  de Medidas de control, los controles correspondientes referenciando el item del riesgo identificado');
                            altura = altura + 6;

                            doc.setFontSize(9);

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(10, altura - 3, 90, 8, 'FD');
                            doc.text(32, altura + 2, 'PELIGROS IDENTIFICADOS');

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(110, altura - 3, 91, 8, 'FD');
                            doc.text(137, altura + 2, 'RIESGOS IDENTIFICADOS');
                            altura = altura + 4;

                            //------LADO IZQUIERDO ---
                            lados = altura;
                            altura = lados;
                            var i = 1;
                            var ladoA = 0;
                            var ladoB = 0;

                            for (item of obj_data) {
                                if (item.lado == 1) {
                                    altura = altura + 4;
                                    doc.setFontSize(11);
                                    doc.text(18, altura, item.valor); doc.rect(10, altura - 3, 20, 4);
                                    doc.text(38, altura, String(i)); doc.rect(30, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(55, altura, item.descripcion); doc.rect(50, altura - 3, 50, 4);
                                    i += 1;
                                }
                            }
                            ladoA = altura;
                            altura = 84;
                            var z = 1;
                            for (item of obj_data) {
                                if (item.lado == 2) {
                                    altura = altura + 4;
                                    doc.setFontSize(11);
                                    doc.text(118, altura, item.valor); doc.rect(110, altura - 3, 20, 4);
                                    doc.text(138, altura, String(z)); doc.rect(130, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(151, altura, item.descripcion); doc.rect(150, altura - 3, 51, 4);
                                    z += 1;
                                }
                            }
                            ladoB = altura;

                            if (ladoA > ladoB) {
                                altura = ladoA;
                            } else {
                                altura = ladoB;
                            }

                            //------LADO DERECHO ---
                            altura = altura + 8;
                            doc.setFontSize(8);
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(10, altura - 3, 90, 4, 'FD'); doc.text(10, altura, 'Otros peligros y riesgos');

                            lados = 0;
                            lados = altura;
                            altura = lados;
                            // lado 3
                            i = 1;
                            for (item of obj_data) {
                                if (item.lado == 3) {
                                    altura = altura + 4;
                                    doc.text(18, altura, item.valor); doc.rect(10, altura - 3, 20, 4);
                                    doc.text(38, altura, String(i)); doc.rect(30, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(55, altura, item.descripcion); doc.rect(50, altura - 3, 50, 4);
                                    i += 1;
                                }
                            }
                            ladoA = altura;
                            altura = lados;
                            //lado 4
                            i = 1;
                            for (item of obj_data) {
                                if (item.lado == 4) {
                                    altura = altura + 4;
                                    doc.text(118, altura, item.valor); doc.rect(110, altura - 3, 20, 4);
                                    doc.text(138, altura, String(i)); doc.rect(130, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(151, altura, item.descripcion); doc.rect(150, altura - 3, 51, 4);
                                    i += 1;
                                }
                            }
                            ladoB = altura;

                            if (ladoA > ladoB) {
                                altura = ladoA;
                            } else {
                                altura = ladoB;
                            }

                            altura = altura + 8;
                            doc.setFontSize(8);

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(10, altura - 3, 191, 4, 'FD');
                            doc.text(10, altura, 'Item del Riesgo'); doc.text(80, altura, 'Medidas de Control del Riesgo');

                            lados = 0;
                            lados = altura;
                            
                             //lado 5
                            for (item of obj_data) {
                                if (item.lado == 5) {
                                    altura = altura + 4;
                                    doc.setFontSize(11);
                                    doc.text(21, altura, item.valor); doc.rect(10, altura - 3, 25, 4);
                                    doc.setFontSize(8);
                                    doc.text(38, altura, item.descripcion); doc.rect(35, altura - 3, 166, 4);
                                }
                            }

                            altura = altura + 8;

                            var generarPDF = function () {
                                var string = doc.output('datauristring');
                                var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";
                                var x = window.open();
                                x.document.open();
                                x.document.write(iframe);
                                x.document.close();
                                //doc.save('Formato2_controlPreventivo.pdf');
                                q.resolve('success');
                            }

                            if (obj_data[0].ruta_foto_1) {

                                //var imgData = String(obj_data[0].ruta_foto_1)
                                var imgData = String('../content/foto/foto/10109278_04092018_1441302710.jpg');
                                var img = new Image;
                                img.onload = function () {
                                    doc.addImage(this, 'JPEG', 125, 226, 40, 30);
                                    generarPDF();
                                };
                                img.crossOrigin = "";
                                img.src = imgData;  // some random imgur image
                                altura = altura + 32;
                                doc.text(127, 260, 'Firma del trabajador.');

                            } else {
                                altura = altura + 32;
                                doc.text(127, 260, 'Firma del trabajador.');
                                generarPDF();
                            }


                        }
                       // Fin  del cuerpo del  reporte

                        var imgDataLogo = String('../Content/Imagen/logoCobra.png');
                        var imgL = new Image;
                        imgL.onload = function () {
                            doc.addImage(this, 'JPEG', 6, 4, 40, 15);
                            cuerpoReporte2();
                        };
                        imgL.crossOrigin = "";
                        imgL.src = imgDataLogo;  // some random imgur image


                    } else {
                        q.resolve('success');
                    }
                })
                .error(function () {
                    $('.sige-load').hide();
                });
            return q.promise;
        }

                     
        var _val = 0;
        var lado1 = 0;
        var lado2 = 0;
        var lado3 = 0;

        $scope.getPdf_calidda = function (data, tipo) {
 
            var q = $q.defer();
            $('.sige-load').show();
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/get_generacionPdf_checkList',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    id_inspeccion: data.id_Inspeccion,
                    tipoReporte: tipo
                }
            }
            $http(variables)
                .success(function (obj_data) {
                    $('.sige-load').hide();
                    if (obj_data.length > 0) {

                        var doc = new jsPDF();
                        var altura = 10;

                        var cuerpoReporte = function () {
                            doc.setFontSize(13);
                            doc.setFont("courier");
                            doc.setFontType("bold");
                            doc.text(50, 18, 'CHECK LIST DE EPP, EQUIPOS Y HERRAMIENTAS');
                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            altura = altura + 4;
                            doc.text(170, altura, 'CO-FO-9122-SSOMA-005');
                            altura = altura + 2.5;
                            doc.text(170, altura, 'Versión: 00');
                            altura = altura + 2.5;
                            doc.text(170, altura, 'Pagina: 01 de 01');
                            altura = altura + 15;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            //doc.text(5, altura, '1. DATOS DEL TRABAJADOR: ');
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 8, 'FD');
                            doc.text(5, altura + 2, '1. DATOS DEL TRABAJADOR:');
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(5, altura, 'APELLIDOS Y NOMBRES: ' + String(obj_data[0].apellidosNombres) ); doc.text(120, altura, 'DNI: ' + String(obj_data[0].dni));
                            altura = altura + 10;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 8, 'FD');
                            doc.text(5, altura + 2, '2. ACTIVIDAD:');

                            altura = altura + 10;

                            doc.setFontSize(7);
                            doc.setFontType("normal");
                            doc.text(10, altura, 'REPARTO'); doc.rect(25, altura - 3, 5, 4); doc.text(26.5, altura, String(obj_data[0].actividadReparto));
                            doc.text(40, altura, 'LECTURA'); doc.rect(55, altura - 3, 5, 4); doc.text(56.5, altura, String(obj_data[0].actividadLectura));
                            doc.text(70, altura, 'RELECTURAS'); doc.rect(90, altura - 3, 5, 4); doc.text(91.5, altura,  String(obj_data[0].actividadRelectura));
                            doc.text(110, altura, 'CORTES Y RECONEXIONES'); doc.rect(145, altura - 3, 5, 4); doc.text(146.5, altura,  String(obj_data[0].actividadCorte));
                            altura = altura + 10;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 8, 'FD');
                            doc.text(5, altura + 2, '3. TIPO DE TRASLADO:');
                            altura = altura + 10;

                            doc.setFontSize(7);
                            doc.setFontType("normal");
                            doc.text(38, altura, 'CAMINANTE'); doc.rect(55, altura - 3, 5, 4); doc.text(57, altura,  String(obj_data[0].transladoCaminante));
                            doc.text(120, altura, 'MOTORIZADO'); doc.rect(140, altura - 3, 5, 4); doc.text(142, altura,  String(obj_data[0].transladoMotorizado));
                            altura = altura + 10;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 8, 'FD');
                            doc.text(5, altura + 2, '4. DATOS GENERALES:');
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(5, altura, ' FECHA: ' + String(obj_data[0].fecha)); doc.text(35, altura, 'DELEGACION: ' + String(obj_data[0].delegacion));
                            doc.text(65, altura, 'UBICACIÓN: ' + String(obj_data[0].ubicacion)); doc.text(175, altura, 'CLIENTE: ' + String(obj_data[0].cliente));

                            altura = altura + 9; ///---- modificado

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 72, 8, 'FD');
                            doc.text(5, altura + 2, '5. DOCUMENTACION: ');
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(6);

                            lado1 = 0;
                            lado2 = 0;
                            lado3 = 0;

                            ///----cabeceras LADO 1----
                            doc.rect(63, altura - 3, 5, 4); doc.text(64, altura, 'SI'); doc.rect(68, altura - 3, 5, 4); doc.text(69, altura, 'NO');
                            for (item of obj_data) {
                                if (item.lado == 1) {
                                    altura = altura + 4;
                                    doc.text(5, altura, String(item.descripcion)); doc.rect(63, altura - 3, 5, 4); doc.text(64.5, altura, String(item.valorSi)); doc.rect(68, altura - 3, 5, 4); doc.text(69.5, altura, String(item.valorNo));
                                }
                            }

                            lado1 = altura;

                            altura = 113
                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(79, altura - 3, 73, 8, 'FD');
                            doc.text(81, altura + 2, '6. EQUIPOS DE PROTECCIÓN PERSONAL: ');
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(6);

                            ///----cabeceras LADO 2 ----
                            doc.text(81, altura, 'B: BUENO ME: MAL ESTADO  NA: NO APLICA  NT: NO TIENE ') ///---- inicio modificado
                            altura = altura + 5;
                            doc.rect(133, altura - 3, 5, 4); doc.text(134.5, altura, 'B'); doc.rect(138, altura - 3, 5, 4); doc.text(139, altura, 'ME'); doc.rect(143, altura - 3, 5, 4); doc.text(144, altura, 'NA'); doc.rect(148, altura - 3, 5, 4); doc.text(149, altura, 'NT');
                            for (item of obj_data) {
                                if (item.lado == 2) {
                                    altura = altura + 4;
                                    doc.text(81, altura, item.descripcion); doc.rect(133, altura - 3, 5, 4); doc.text(134.5, altura, item.valorBueno); doc.rect(138, altura - 3, 5, 4); doc.text(139.5, altura, item.valorMal); doc.rect(143, altura - 3, 5, 4); doc.text(144.5, altura, item.valorNa); doc.rect(148, altura - 3, 5, 4); doc.text(149.5, altura, item.valorNt);
                                }
                            }
                            ///---- fin modificado
                            lado2 = altura;

                            altura = 113
                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(157, altura - 3, 52, 8, 'FD');///---- modificado
                            doc.text(158, altura + 2, '7. EQUIPOS Y HERRAMIENTAS: '); ///---- modificado
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(6);

                            ///----cabeceras LADO 3 ----
                            doc.text(159, altura, 'B:BUENO  ME:MAL ESTADO  NA:NO APLICA') ///---- modificado
                            altura = altura + 3;
                            doc.text(159, altura, 'NT: NO TIENE ') ///---- modificado
                            altura = altura + 2;
                            doc.rect(188, altura - 3, 5, 4); doc.text(189.5, altura, 'B'); doc.rect(193, altura - 3, 5, 4); doc.text(194, altura, 'ME'); doc.rect(198, altura - 3, 5, 4); doc.text(199, altura, 'NA'); doc.rect(203, altura - 3, 5, 4); doc.text(204, altura, 'NT')///---- modificado
                                   
                            for (item of obj_data) {
                                if (item.lado == 3) {
                                    altura = altura + 4;
                                    doc.text(158, altura, item.descripcion); doc.rect(188, altura - 3, 5, 4); doc.text(189.5, altura, item.valorBueno); doc.rect(193, altura - 3, 5, 4); doc.text(194.5, altura, item.valorMal); doc.rect(198, altura - 3, 5, 4); doc.text(199.5, altura, item.valorNa) ; doc.rect(203, altura - 3, 5, 4); doc.text(204.5, altura, item.valorNt);
                                }
                            }

                            lado3 = altura;

                            if (lado1 == lado2 && lado1 == lado3) {
                                altura = lado1;
                            }
                            else {
                                if (lado1 > lado2) {
                                    if (lado1 > lado3) {
                                        altura = lado1;
                                    }
                                    else {
                                        altura = lado3;
                                    }
                                }
                                else {
                                    if (lado1 < lado2) {
                                        if (lado2 > lado3) {
                                            altura = lado2;
                                        }
                                        else {
                                            altura = lado3;
                                        }
                                    }
                                }
                            }

                            altura = altura + 10;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 8, 'FD');
                            doc.text(5, altura + 2, '8. OBSERVACIONES: ');
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            var splitTitle = doc.splitTextToSize(String(obj_data[0].observaciones), 200);

                            //----como la obsevacion es dinamico obtenemos los espacios dinamicos tambien----
                            doc.text(5, altura, splitTitle);
                            _val = 0;
                            if (splitTitle.length == 0) {
                                _val = 8;
                            } else {
                                if (splitTitle.length == 1) {
                                    _val = 8;
                                } else {
                                    _val = (4 * splitTitle.length);
                                }
                            }
                            altura = (altura + _val);

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 8, 'FD');
                            doc.text(5, altura + 2, '9. DECLARACIÓN JURADA: ');
                            altura = altura + 10;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            var splitTitle2 = doc.splitTextToSize(String('Estoy de acuerdo con cada uno de los lineamientos y sanciones que se pueda generar por el incumplimiento del Reglamento Interno de Seguridad y Salud en el trabajo. '), 200);
                            doc.text(5, altura, splitTitle2);


                            //var string = doc.output('datauristring');
                            //var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";
                            //var x = window.open();
                            //x.document.open();
                            //x.document.write(iframe);
                            //x.document.close();
                            doc.save('Formato1_caminante.pdf');

                            q.resolve('success');

                        }
                        ///-------
                        var imgDataLogo = String('../Content/Imagen/logoCobra.png');
                        var imgL = new Image;
                        imgL.onload = function () {
                            doc.addImage(this, 'JPEG', 3, 8, 40, 15);
                            cuerpoReporte();
                        };
                        imgL.crossOrigin = "";
                        imgL.src = imgDataLogo;  // some random imgur image

                    } else {
                        q.resolve('success');
                    }
                })
                .error(function () {
                        $('.sige-load').hide();
                });
            return q.promise;

        }
               
        $scope.getPdf_motorizado = function (data, tipo) {
            var q = $q.defer();
            $('.sige-load').show();
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/get_generacionPdf_checkList',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    id_inspeccion: data.id_Inspeccion,
                    tipoReporte: tipo
                }
            }
            $http(variables)
                .success(function (obj_data) {
                    $('.sige-load').hide();
                    if (obj_data.length > 0) {
                        var doc = new jsPDF();
                        var altura = 10;

                        var cuerpoReporte = function () {
                            doc.setFontSize(13);
                            doc.setFont("courier");
                            doc.setFontType("bold");
                            doc.text(50, 15, 'CHECK LIST DE EPP, EQUIPOS Y HERRAMIENTAS');
                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            altura = altura + 4;
                            doc.text(170, altura, 'CO-FO-9122-SSOMA-005');
                            altura = altura + 2.5;
                            doc.text(170, altura, 'Versión: 00');
                            altura = altura + 2.5;
                            doc.text(170, altura, 'Pagina: 01 de 01');
                            altura = altura + 5;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            //doc.text(5, altura, '1. DATOS DEL TRABAJADOR: ');
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '1. DATOS DEL TRABAJADOR:');
                            altura = altura + 7;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(5, altura, 'APELLIDOS Y NOMBRES: ' + String(obj_data[0].apellidosNombres)); doc.text(120, altura, 'DNI: ' + String(obj_data[0].dni) );
                            altura = altura + 6;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '2. ACTIVIDAD:');

                            altura = altura + 8;

                            doc.setFontSize(7);
                            doc.setFontType("normal");
                            doc.text(10, altura, 'REPARTO'); doc.rect(25, altura - 3, 5, 4); doc.text(26.5, altura, String(obj_data[0].actividadReparto) );
                            doc.text(40, altura, 'LECTURA'); doc.rect(55, altura - 3, 5, 4); doc.text(56.5, altura, String(obj_data[0].actividadLectura) );
                            doc.text(70, altura, 'RELECTURAS'); doc.rect(90, altura - 3, 5, 4); doc.text(91.5, altura, String(obj_data[0].actividadRelectura) );
                            doc.text(110, altura, 'CORTES Y RECONEXIONES'); doc.rect(145, altura - 3, 5, 4); doc.text(146.5, altura, String(obj_data[0].actividadCorte) );
                            altura = altura + 7;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '3. TIPO DE TRASLADO:');
                            altura = altura + 8;

                            doc.setFontSize(7);
                            doc.setFontType("normal");
                            doc.text(38, altura, 'CAMINANTE'); doc.rect(55, altura - 3, 5, 4); doc.text(56.5, altura, String(obj_data[0].transladoCaminante) );
                            doc.text(120, altura, 'MOTORIZADO'); doc.rect(140, altura - 3, 5, 4); doc.text(141.5, altura, String(obj_data[0].transladoMotorizado) );
                            altura = altura + 6;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '4. DATOS GENERALES:');
                            altura = altura + 7;

                            doc.setFontType("normal");
                            doc.setFontSize(7);

                            doc.text(5, altura, ' FECHA: ' + String(obj_data[0].fecha)); doc.text(35, altura, 'DELEGACION: ' + String(obj_data[0].delegacion));
                            doc.text(65, altura, 'UBICACIÓN: ' + String(obj_data[0].ubicacion)); doc.text(180, altura, 'CLIENTE: ' + String(obj_data[0].cliente));

                            altura = altura + 6;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 72, 6, 'FD');
                            doc.text(5, altura + 1, '5. DATOS DE VEHICULO ');
                            altura = altura + 7;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(5, altura, ' Placa de la unidad: ' + String(obj_data[0].placa)); doc.text(150, altura, 'Año Fabric: ' + String(obj_data[0].anio) );
                            altura = altura + 4;
                            doc.text(5, altura, ' Marca de la unidad: ' + String(obj_data[0].marca)); doc.text(150, altura, 'Kilometraje: ' + String(obj_data[0].kilometraje) );
                            altura = altura + 4;
                            doc.text(5, altura, ' Modelo: ' + String(obj_data[0].modelo)); doc.text(150, altura, 'Cilindrada: ' + String(obj_data[0].cilindraje) );
                            altura = altura + 6;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 97, 6, 'FD');
                            doc.text(5, altura + 1, '6. DOCUMENTACION: ');
                            altura = altura + 8;

                            lado1 = 0;
                            lado2 = 0;

                            doc.setFontType("normal");
                            doc.setFontSize(6.5);

                            ///----cabeceras LADO 1----
                            doc.rect(67, altura - 3, 5, 4); doc.text(68.5, altura, 'SI'); doc.rect(72, altura - 3, 5, 4); doc.text(73.5, altura, 'NO'); doc.rect(77, altura - 3, 5, 4); doc.text(78.5, altura, 'NA'); doc.rect(82, altura - 3, 17, 4); doc.text(83.5, altura, 'F.VIGENCIA');
                            for (item of obj_data) {
                                if (item.lado == 1) {
                                    altura = altura + 4;                                 
                                    doc.text(5, altura, String(item.descripcion)); doc.rect(67, altura - 3, 5, 4); doc.text(68.5, altura, String(item.valorSi)); doc.rect(72, altura - 3, 5, 4); doc.text(73.5, altura, String(item.valorNo));doc.rect(77, altura - 3, 5, 4); doc.text(78.5, altura, String(item.valorNa));doc.rect(82, altura - 3, 17, 4); doc.text(83.5, altura, String(item.valorfecha));
                                }
                            }

                            lado1 = altura;
                            altura = 100;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(110, altura - 3, 97, 6, 'FD');
                            doc.text(112, altura + 1, '7. EQUIPOS DE SEGURIDAD Y HERRAMIENTAS :');
                            altura = altura + 8;

                            doc.setFontType("normal");
                            doc.setFontSize(6.5);
                            ///----cabeceras LADO 2----
                            doc.rect(150, altura - 3, 5, 4); doc.text(151.5, altura, 'SI'); doc.rect(155, altura - 3, 5, 4); doc.text(156.5, altura, 'NO'); doc.rect(160, altura - 3, 5, 4); doc.text(161.5, altura, 'NT'); doc.rect(160, altura - 3, 47, 4); doc.text(170.5, altura, 'OBSERVACIONES');
                            for (item of obj_data) {
                                if (item.lado == 2) {
                                    altura = altura + 4;
                                    doc.text(112, altura, String(item.descripcion)); doc.rect(150, altura - 3, 5, 4); doc.text(151.5, altura, String(item.valorSi)); doc.rect(155, altura - 3, 5, 4); doc.text(156.5, altura, String(item.valorNo)); doc.rect(160, altura - 3, 5, 4); doc.text(161.5, altura, String(item.valorNt)); doc.rect(160, altura - 3, 47, 4); doc.text(166.5, altura, String(item.valorObservaciones));
                                }
                            }


                            lado2 = altura;

                            if (lado1 > lado2) {
                                altura = lado1;
                            } else {
                                altura = lado2;
                            }
                            altura = altura + 8;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '8. REVISION DEL VEHICULO: ');
                            altura = altura + 7;

                            doc.setFontType("normal");
                            doc.setFontSize(6.5);

                            lado1 = 0;
                            lado2 = 0;
                            lado3 = 0;


                            //----NUEVO JULIO  --- Modificado
                            var ac = 1;
                            doc.text(5, altura, 'B : BUENO    ME : MAL ESTADO   NA : NO APLICA   NT : NO TIENE ')
                            altura = altura + 5;

                            doc.rect(50, altura - 3, 5, 4); doc.text(51.5, altura, 'B'); doc.rect(55, altura - 3, 5, 4); doc.text(56.5, altura, 'ME'); doc.rect(60, altura - 3, 5, 4); doc.text(61.5, altura, 'NA'); doc.rect(65, altura - 3, 5, 4); doc.text(66.5, altura, 'NT');
                            /////----cabeceras LADO 2 ---- 
                            doc.rect(118, 172 - 3, 5, 4); doc.text(119.5, 172, 'B'); doc.rect(123, 172 - 3, 5, 4); doc.text(124.5, 172, 'ME'); doc.rect(128, 172 - 3, 5, 4); doc.text(129.5, 172, 'NA'); doc.rect(133, altura - 3, 5, 4); doc.text(134.5, altura, 'NT');
                            /////----cabeceras LADO 3 ---- 
                            doc.rect(188, 172 - 3, 5, 4); doc.text(189.5, 172, 'B'); doc.rect(193, 172 - 3, 5, 4); doc.text(194, 172, 'ME'); doc.rect(198, 172 - 3, 5, 4); doc.text(199, 172, 'NA'); doc.rect(203, altura - 3, 5, 4); doc.text(204.5, altura, 'NT');

                            for (item of obj_data) {
                                if (item.lado == 3) {
                                    altura = altura + 4;
                                    if (ac <= 15) {
                                        doc.text(4, altura, ac + ' ' + String(item.descripcion)); doc.rect(50, altura - 3, 5, 4); doc.text(51.5, altura, String(item.valorBueno)); doc.rect(55, altura - 3, 5, 4); doc.text(56.5, altura, String(item.valorMal)); doc.rect(60, altura - 3, 5, 4); doc.text(61.5, altura, String(item.valorNa)); doc.rect(65, altura - 3, 5, 4); doc.text(66.5, altura, String(item.valorNt));
                                        if (ac == 15) {
                                            lado1 = altura
                                            altura = 172
                                        }
                                        ac += 1;
                                    }      
                                    else if (ac > 15 && ac <= 30) {
 
                                        doc.text(73, altura, ac + ' ' + String(item.descripcion)); doc.rect(118, altura - 3, 5, 4); doc.text(119.5, altura, String(item.valorBueno)); doc.rect(123, altura - 3, 5, 4); doc.text(124.5, altura, String(item.valorMal)); doc.rect(128, altura - 3, 5, 4); doc.text(129.5, altura, String(item.valorNa)); doc.rect(133, altura - 3, 5, 4); doc.text(134.5, altura, String(item.valorNt));
                                        if (ac == 30) {
                                            altura = 172
                                        }
                                        ac += 1;
                                    }   
                                    else if (ac > 30) {
                                        doc.text(141, altura, ac + ' ' + String(item.descripcion)); doc.rect(188, altura - 3, 5, 4); doc.text(189.5, altura, String(item.valorBueno)); doc.rect(193, altura - 3, 5, 4); doc.text(194.5, altura, String(item.valorMal)); doc.rect(198, altura - 3, 5, 4); doc.text(199.5, altura, String(item.valorNa)); doc.rect(203, altura - 3, 5, 4); doc.text(204.5, altura, String(item.valorNt));
                                        ac += 1;
                                    }  
                                }                   
                            }
                            ///--- fin de Modificado
 
                            altura = lado1;
                            altura = altura + 7;

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '9. OBSERVACIONES: ');
                            altura = altura + 7;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            var splitTitle = doc.splitTextToSize(String(obj_data[0].observaciones), 200);

                            //----como la obsevacion es dinamico obtenemos los espacios dinamicos tambien----
                            doc.text(5, altura, splitTitle);
                            _val = 0;
                            if (splitTitle.length == 0) {
                                _val = 8;
                            } else {
                                if (splitTitle.length == 1) {
                                    _val = 8;
                                } else {
                                    _val = (4 * splitTitle.length);
                                }
                            }
                            altura = (altura + _val);

                            doc.setFontSize(9);
                            doc.setFontType("bold");
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(3, altura - 3, 205, 6, 'FD');
                            doc.text(5, altura + 1, '10. DECLARACIÓN JURADA: ');
                            altura = altura + 7;

                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            var splitTitle2 = doc.splitTextToSize(String('Estoy de acuerdo con cada uno de los lineamientos y sanciones que se pueda generar por el incumplimiento del Reglamento Interno de Seguridad y Salud en el trabajo. '), 200);
                            doc.text(5, altura, splitTitle2);


                            //var string = doc.output('datauristring');
                            //var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";
                            //var x = window.open();
                            //x.document.open();
                            //x.document.write(iframe);
                            //x.document.close();

                            doc.save('Formato2_motorizado.pdf');
                            q.resolve('success');

                        }
                        ///-------
                        var imgDataLogo = String('../Content/Imagen/logoCobra.png');
                        var imgL = new Image;
                        imgL.onload = function () {
                            doc.addImage(this, 'JPEG', 3, 4, 40, 15);
                            cuerpoReporte();
                        };
                        imgL.crossOrigin = "";
                        imgL.src = imgDataLogo;  // some random imgur image

                    } else {
                        q.resolve('success');
                    }
                })
                .error(function () {
                    $('.sige-load').hide();
                });
            return q.promise;
        }
               
        $scope.getPdf_charla = function (data, tipo) {
            var q = $q.defer();

            $('.sige-load').show();
            var variables = {
                method: 'POST',
                url: '../GeneracionActas/get_generacionPdf_checkList',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                data: {
                    id_inspeccion: data.id_Inspeccion,
                    tipoReporte: tipo
                }
            }

            $http(variables)
                .success(function (obj_data) {
                    $('.sige-load').hide();
                    if (obj_data.length > 0) {
                        var doc = new jsPDF();
                        var altura = 12;
                        var lados = 0;

                        // inicio del cuerpo del  reporte
                        var cuerpoReporte2 = function () {

                            doc.setFontSize(13);
                            doc.setFont("courier");
                            doc.setFontType("bold");
                            doc.text(80, altura, 'CONTROL PREVENTIVO');
                            doc.setFontType("normal");
                            doc.setFontSize(6);
                            doc.text(165, altura, 'Código: ' + obj_data[0].codigo);
                            altura = altura + 3;
                            doc.setFontType("normal");
                            doc.setFontSize(7);
                            doc.text(90, altura, 'CHARLA PREOPERACIONAL'); doc.setFontSize(6); doc.text(165, altura, 'Rev.: ' + obj_data[0].rev);
                            altura = altura + 3;
                            doc.setFontSize(7);
                            doc.text(90, altura, 'Servicios Auxiliares'); doc.setFontSize(6); doc.text(165, altura, 'Fecha: ' + obj_data[0].fecha);
                            altura = altura + 8;
                            doc.setFontSize(8);
                            doc.setFontType("bold");

                            doc.text(6, altura, 'RESPONSABLE DE TRABAJO: ' + obj_data[0].responsable);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.text(6, altura, 'ACTIVIDAD A REALIZAR: ' + obj_data[0].titulo);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.text(6, altura, 'LUGAR: ' + obj_data[0].lugar); doc.text(145, altura, 'FECHA: ' + obj_data[0].fechafiltro); doc.text(175, altura, 'HORA: ' + obj_data[0].hora);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.text(6, altura, 'CLIENTE: ' + obj_data[0].empresa);
                            doc.line(6, altura + 1.5, 200, altura + 1.5) // horizontal line
 

        

                            altura = altura + 10;
                            doc.text(35, altura, 'ANTES DE REALIZAR LOS TRABAJOS ASIGNADOS VERIFICAR Y REALIZAR LO SIGUIENTE: ');
                            doc.line(35, altura + 1.5, 160, altura + 1.5) // horizontal line
                            altura = altura + 6;
                            doc.setFontSize(7);
                            doc.text(6, altura, '¤ Charla Pre Operacional, reconociendo previamente su zona de trabajo. Identificar los peligros y evaluar los riesgos, ');
                            altura = altura + 3;
                            doc.text(6, altura, '  estableciendo las medidas de control vinculadas.');
                            altura = altura + 4;
                            doc.text(6, altura, '¤ Revisar que los EPP, herramientas y otros medios de trabajos se encuentren en buen estado de conservación.');

                            altura = altura + 4;
                            doc.setFontType("normal");
                            doc.text(6, altura, '* Luego de la evaluación del entorno de trabajo, marcar con una X los peligros y riesgos identificados. Anotar en el apartado');
                            altura = altura + 3;
                            doc.text(6, altura, '*  de Medidas de control, los controles correspondientes referenciando el item del riesgo identificado');
                            altura = altura + 6;

                            doc.setFontSize(9);

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(10, altura - 3, 90, 8, 'FD');
                            doc.text(32, altura + 2, 'PELIGROS IDENTIFICADOS');

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(110, altura - 3, 91, 8, 'FD');
                            doc.text(137, altura + 2, 'RIESGOS IDENTIFICADOS');
                            altura = altura + 4;

                            //------LADO IZQUIERDO --- hay que aprender  
                            lados = altura;
                            altura = lados;
                            var i = 1;
                            var ladoA = 0;
                            var ladoB = 0;

                            for (item of obj_data) {
                                if (item.lado == 1) {
                                    altura = altura + 4;
                                    doc.setFontSize(11);
                                    doc.text(18, altura, item.valor); doc.rect(10, altura - 3, 20, 4);
                                    doc.text(38, altura, String(i)); doc.rect(30, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(55, altura, item.descripcion); doc.rect(50, altura - 3, 50, 4);
                                    i += 1;
                                }
                            }
                            ladoA = altura;
                            altura = 84;
                            var z = 1;
                            for (item of obj_data) {
                                if (item.lado == 2) {
                                    altura = altura + 4;
                                    doc.setFontSize(11);
                                    doc.text(118, altura, item.valor); doc.rect(110, altura - 3, 20, 4);
                                    doc.text(138, altura, String(z)); doc.rect(130, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(151, altura, item.descripcion); doc.rect(150, altura - 3, 51, 4);
                                    z += 1;
                                }
                            }
                            ladoB = altura;

                            if (ladoA > ladoB) {
                                altura = ladoA;
                            } else {
                                altura = ladoB;
                            }

                            //------LADO DERECHO ---
                            altura = altura + 8;
                            doc.setFontSize(8);
                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(10, altura - 3, 90, 4, 'FD'); doc.text(10, altura, 'Otros peligros y riesgos');

                            lados = 0;
                            lados = altura;
                            altura = lados;
                            // lado 3
                            i = 1;
                            for (item of obj_data) {
                                if (item.lado == 3) {
                                    altura = altura + 4;
                                    doc.text(18, altura, item.valor); doc.rect(10, altura - 3, 20, 4);
                                    doc.text(38, altura, String(i)); doc.rect(30, altura - 3, 20, 4);
                                    doc.setFontSize(7); doc.text(55, altura, item.descripcion); doc.rect(50, altura - 3, 50, 4);
                                    i += 1;
                                }
                            }
                            ladoA = altura;
                            altura = lados;
                            //lado 4
                            i = 1;
                            for (item of obj_data) {
                                if (item.lado == 4) {
                                    altura = altura + 4;
                                    doc.text(118, altura, item.valor); doc.rect(110, altura - 3, 20, 4);
                                    doc.text(138, altura, String(i)); doc.rect(130, altura - 3, 20, 4);
                                    doc.setFontSize(7);
                                    doc.text(151, altura, item.descripcion); doc.rect(150, altura - 3, 51, 4);
                                    i += 1;
                                }
                            }
                            ladoB = altura;

                            if (ladoA > ladoB) {
                                altura = ladoA;
                            } else {
                                altura = ladoB;
                            }

                            altura = altura + 8;
                            doc.setFontSize(8);

                            doc.setDrawColor(0)
                            doc.setFillColor(220, 220, 220)
                            doc.rect(10, altura - 3, 191, 4, 'FD');
                            doc.text(10, altura, 'Item del Riesgo'); doc.text(80, altura, 'Medidas de Control del Riesgo');

                            lados = 0;
                            lados = altura;

                            //lado 5
                            i = 1;
                            for (item of obj_data) {
                                if (item.lado == 5) {
                                    altura = altura + 4;
                                    doc.setFontSize(11);
                                    doc.text(21, altura, String(i)); doc.rect(10, altura - 3, 25, 4);
                                    doc.setFontSize(8);
                                    doc.text(38, altura, item.descripcion); doc.rect(35, altura - 3, 166, 4);
                                    i += 1;
                                }
                            }

                            altura = altura + 8;

                            var generarPDF = function () {
                                //var string = doc.output('datauristring');
                                //var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";
                                //var x = window.open();
                                //x.document.open();
                                //x.document.write(iframe);
                                //x.document.close();
                                doc.save('Formato3_charlaPreoperacional.pdf');
                                q.resolve('success');
                            }


                            generarPDF();

                            //if (obj_data[0].ruta_foto_1) {
                            // 
                            //    //var imgData = String(obj_data[0].ruta_foto_1)
                            //    var imgData = String('../content/foto/foto/10109278_04092018_1441302710.jpg');
                            //    var img = new Image;
                            //    img.onload = function () {
                            //        doc.addImage(this, 'JPEG', 125, 226, 40, 30);
                            //        generarPDF();
                            //    };
                            //    img.crossOrigin = "";
                            //    img.src = imgData;  // some random imgur image
                            //    altura = altura + 32;
                            //    doc.text(127, 260, 'Firma del trabajador.');

                            //} else {
                            //    altura = altura + 32;
                            //    doc.text(127, 260, 'Firma del trabajador.');
                            //    generarPDF();
                            //}
                        }
                        // Fin  del cuerpo del  reporte

                        var imgDataLogo = String('../Content/Imagen/logoCobra.png');
                        var imgL = new Image;
                        imgL.onload = function () {
                            doc.addImage(this, 'JPEG', 6, 4, 40, 15);
                            cuerpoReporte2();
                        };
                        imgL.crossOrigin = "";
                        imgL.src = imgDataLogo;  // some random imgur image


                    } else {
                        q.resolve('success');
                    }
                })
                .error(function () {
                    $('.sige-load').hide();
                });
            return q.promise;
        }

        
        function getDateNow() {
            var meses = new Array("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre");
            var diasSemana = new Array("Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado");
            var f = new Date()
            return diasSemana[f.getDay()] + ", " + f.getDate() + " de " + meses[f.getMonth()] + " de " + f.getFullYear();
        };

        function getDateHour() {
            var f = new Date()
            return f.getHours() + ':' + f.getMinutes() + ':' + f.getSeconds();
        }
    });

</script>


<div class="panel panel-oscuro" ng-app="appControlPreventivo" ng-controller="ctrlControl" ng-init="inicializando_variables();">
    <div class="panel-heading">
        <h6><i class="fa fa-table fa-lg"></i> REPORTES CONTROL PREVENTIVO </h6>

    </div>
    <div class="panel-body">
        <div id="Contenedor">
            <form class="form-inline">
                <div class="row" style=" margin-top: -10px;">
                    <div class="col-lg-12">
                        <div class="well" style="background: #314b75; color: white;">
                            <center>

                                <div class="form-group" style="padding-left: 15px;">
                                    <label for="cbo_area" style="font-size:11px; margin-top: 5px;">Actividad:</label>
                                    <select id="cbo_area" class="form-control" ng-model="id_area">
                                        <option value=0>--[ Seleccione ]-- </option>
                                        <option ng-repeat="item in Obj_List_Servicios" value="{{item.id_Area}}">
                                            {{item.nombre_area}}
                                        </option>
                                    </select>
                                </div>

                                <div class="form-group" style="padding-left: 15px;">
                                    <label for="id_fecha" style="font-size:11px">Fecha: </label>
                                    <input class="form-control" style="width: 150px;" id="id_fecha" placeholder="dia/mes/año" type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" />
                                </div>

                                <div class="form-group" style="padding-left: 15px;  margin-top: 5px;">
                                    <label for="cbo_operario" style="font-size:11px">Operario:</label>
                                    <select id="cbo_operario" class="form-control" ng-model="id_operario">
                                        <option value=0>--[ Todos ]-- </option>
                                        <option ng-repeat="item in Obj_List_Operario" value="{{item.id_Operario}}">
                                            {{item.id_Operario}} : {{item.desc_operario}}
                                        </option>
                                    </select>
                                </div>


                                <div class="form-group" style="padding-left: 15px;  margin-top: 5px;">
                                    <label for="cbo_tipoReporte" style="font-size:11px">Tipo Reporte:</label>
                                    <select id="cbo_tipoReporte" class="form-control" ng-model="tipo_reporte">
                                        <option value=1>Caminante </option>
                                        <option value=2>Motorizado</option>
                                        <option value=3>Charla Pre-operacional </option>
                                    </select>
                                </div>

                                <div class="form-group" style="padding-left: 15px; margin-top: 5px;">
                                    <button class="btn btn-success" style=" font-size: 14px;" ng-click="Listado_Cabecera_Inspecciones();"><span class="glyphicon glyphicon-refresh"></span> Mostrar</button>
                                    <button class="btn btn-primary " ng-click="descargarMasivo();"><span class="glyphicon glyphicon-download-alt"></span> PDF</button>

                                    @*<button class="btn btn-danger " ng-click="getPdf_calidda();"><span class="glyphicon glyphicon-download-alt"></span> pruebas</button>*@
                                </div>
                            </center>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{progress}}%;" aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100">{{progress | number : 2}}%</div>
        </div>


        <div class="row">
            <div class="col-lg-12">
                <div id="Principal" class="table-responsive">
                    <table id="tblLista" class="table  table-bordered table-responsive" border="0" cellspacing="0" cellpadding="0" style="font-size:11px">
                        <thead style="color:#7991a5;">
                            <tr>
                                <th style="text-align:center">#</th>
                                <th style="text-align:center">Nro_Inspección</th>
                                <th style="text-align:center">Fecha Inspección</th>
                                <th style="text-align:center">Operario</th>
                                <th style="text-align:center"> Descargar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="item in Obj_List_Cabecera" on-finish-render="ngRepeatFinished_cabecera">
                                <td>{{$index + 1}}</td>
                                <td style="text-align:center">{{item.nro_Inspeccion}}</td>
                                <td style="text-align:center">{{item.fecha_inspeccion}}</td>
                                <td>{{item.operario}}</td>
                                <td style="text-align:center"> <button class="btn btn-xs btn-primary" ng-click="crear_pdf_inspecciones(item)"><span class="glyphicon glyphicon-download-alt"></span> </button> </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


